<div class="card-container main-card">
  <mat-card>
    <div *ngIf="matDataSource | async as source">
      <div class="table-container">
        <table id="main-table" mat-table matSort [dataSource]="source">
          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox
                (change)="$event ? masterToggle(source) : null"
                [checked]="selection.hasValue() && isAllSelected(source)"
                [indeterminate]="selection.hasValue() && !isAllSelected(source)"
                [aria-label]="checkboxLabel(source)"
              >
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox
                (click)="$event.stopPropagation()"
                (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)"
                [aria-label]="checkboxLabel(row, source)"
              >
              </mat-checkbox>
            </td>
          </ng-container>

          <ng-container matColumnDef="provinces">
            <th mat-header-cell *matHeaderCellDef>Provinces</th>
            <td mat-cell *matCellDef="let element">{{ element.provinces?.length }}</td>
          </ng-container>

          <ng-container matColumnDef="country">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Country</th>
            <td mat-cell *matCellDef="let element">{{ element.country }}</td>
          </ng-container>

          <ng-container matColumnDef="confirmed">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Confirmed</th>
            <td mat-cell *matCellDef="let element">{{ element.confirmed }}</td>
          </ng-container>

          <ng-container matColumnDef="deaths">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Deaths</th>
            <td mat-cell *matCellDef="let element">{{ element.deaths }}</td>
          </ng-container>

          <ng-container matColumnDef="recovered">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Recovered</th>
            <td mat-cell *matCellDef="let element">{{ element.recovered }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="selection.toggle(row)"></tr>
        </table>
      </div>
      <div id="data-parameters">
        <mat-form-field class="margin-lr-1">
          <mat-label>Filter</mat-label>
          <input matInput (keyup)="applyFilter(source, $event)" />
        </mat-form-field>

        <mat-form-field class="margin-lr-1">
          <mat-label>Chart type</mat-label>
          <mat-select [(value)]="selectChartType">
            <mat-option>None</mat-option>
            <mat-option value="1">Line chart</mat-option>
            <mat-option value="2" default>Stacked chart</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <mat-paginator [pageSizeOptions]="[15, 30, 50]" showFirstLastButtons></mat-paginator>
  </mat-card>
</div>

<div class="card-container main-card">
  <mat-card>
    <div class="chart-container">
      <mat-tab-group [(selectedIndex)]="selectedDataType">
        <mat-tab label="Confirmed">
          <ng-container
            *ngTemplateOutlet="
              chartArea;
              context: { dataSeries: 0, chartType: selectChartType, countries$: charts.ngx.countries$ }
            "
            matTabContent
          >
          </ng-container>
        </mat-tab>
        <mat-tab label="Deaths">
          <ng-container
            *ngTemplateOutlet="
              chartArea;
              context: { dataSeries: 1, chartType: selectChartType, countries$: charts.ngx.countries$ }
            "
            matTabContent
          >
          </ng-container>
        </mat-tab>
        <mat-tab label="Recovered">
          <ng-container
            *ngTemplateOutlet="
              chartArea;
              context: { dataSeries: 2, chartType: selectChartType, countries$: charts.ngx.countries$ }
            "
            matTabContent
          >
          </ng-container>
        </mat-tab>
      </mat-tab-group>
    </div>
  </mat-card>
</div>

<ng-template #chartArea let-countries$="countries$" let-chartType="chartType" let-dataSeries="dataSeries">
  <app-chart-area [dataSeries]="dataSeries" [chartType]="chartType" [countries]="countries$ | async"></app-chart-area>
</ng-template>
